---
title: "Demo_Analysis"
author: "Quadrant-4"
date: "September 22, 2016"
output: html_document
---
This document elicits the inferential studies done on the Midtronics Stationary Division data.

The analysis will look at the trends of batteries who have a sharp dip in conductance and then a subsequent rise.

The approach taken to identify the subject batteries, is to consolidate conductance data with respect to the unique IDs and take the standard deviation of all the readings. This is required to find the spread of the conductance readings. This approach is derived from the premise that batteries with large drop in conductance values will also have larger Standard Deviation

However, we first have to remove outliers if it exist

```{r}

library(dplyr)
library(ggplot2)

summary(All_discharge$Conductance)
summary(All_discharge$Conductance_High_Warning)

range(as.numeric(as.character(All_discharge$Conductance)),na.rm = TRUE) # Range of Conductance

range(as.numeric(as.character(All_discharge$Conductance_High_Warning)),na.rm = TRUE) # Range of Conductance high warning



```

There are some very high values which possibly are outliers. Need to eliminate such values. Let us try a filter and see those values

```{r}
nrow(All_discharge %>% filter(Conductance > 10000))

```

There are around 47 values which are larger than 10,000. Let us eliminate those values which are above 10,000

```{r}

filt1 <- All_discharge %>% filter(Conductance < 10000)

# Let us also normalise the Conductance data and look for trends

library(dplyr)
library(caret)



tempnorm <- preProcess(filt1[,7:8],method = c("center","scale"))

transformed <- predict(tempnorm,filt1[,7:8])

filt1$tempnorm <- transformed$Conductance

```


Next task is to create a new data frame with standard deviation of each of the batteries as a seperate variable

```{r}

Cond_SD <- filt1 %>% group_by(Unique_ID) %>% summarise(SD = sd(Conductance,na.rm=TRUE),Var=var(Conductance,na.rm=TRUE),Mean = mean(Conductance,na.rm=TRUE))

# Normalised SD

Cond_normSD <- filt1 %>% group_by(Unique_ID) %>% summarise(SD = sd(tempnorm,na.rm=TRUE),Var=var(tempnorm,na.rm=TRUE),Mean = mean(tempnorm,na.rm=TRUE))

```

Let us do some plots and identify some of the batteries with high values of SD

```{r}

q1 <- ggplot(data=Cond_SD,aes(Unique_ID,SD)) + geom_point()

q1 + theme(axis.text.x = element_text(angle=70,hjust=1))

# Normalised
library(ggplot2)

q1 <- ggplot(data=Cond_normSD,aes(Unique_ID,SD)) + geom_point()

q1 + theme(axis.text.x = element_text(angle=70,hjust=1))


```

From the above data cases where SD is greater than 200 could potentially be those cases where we will find the failing cases

```{r}

filt2 <- Cond_SD %>% filter(SD > 200)

# Lets plot


q2 <- ggplot(data=filt2,aes(Unique_ID,SD)) + geom_point()

q2 + theme(axis.text.x = element_text(angle=70,hjust=1))

range(filt2$SD)

```

Let us first take the case where the SD is more than 700 and see how it fares

```{r}
Cond_SD %>% filter(SD > 700) %>% select(Unique_ID)

# "5C662FAB-6334-49BF-9A08-1BB9F44AA9F6"

```

Let us take the case of this battery and observe the behaviour accross the days

```{r}

filt3 <- filt1 %>% filter(Unique_ID == "5C662FAB-6334-49BF-9A08-1BB9F44AA9F6")

# Lets create a date variable

filt3$Date <- as.Date(as.character(filt3$Measurement_Timestamp))

# Let us do some plotting as per date

q3 <- ggplot(data=filt3,aes(Date,Conductance)) + geom_point()
q3+ theme(axis.text.x = element_text(angle=90,hjust = 1))


```

The above dosent seem to be a case of failing battery. The above seems more like some anomolous behaviour than a failure

Next let us look at batteries from the next band

# Battery with values > 600 but less than 700

```{r}

Cond_SD %>% filter(SD > 600 & SD < 700) %>% select(Unique_ID)

# "1BB0B287-453B-4123-9DA5-AF6F6596B28F"
# "5F47EE46-50C4-4A8A-8CAC-C483A7AEA880"

```

Let us take the case of these batteries and observe the behaviour accross the days

```{r}

filt4 <- All_discharge %>% filter(Unique_ID %in% c("1BB0B287-453B-4123-9DA5-AF6F6596B28F","5F47EE46-50C4-4A8A-8CAC-C483A7AEA880"))

# Lets create a date variable

filt4$Date <- as.Date(as.character(filt4$Measurement_Timestamp))


# Let us do some plotting as per date

q4 <- ggplot(data=filt4,aes(Date,Conductance,color=Unique_ID)) + geom_point() + facet_grid(.~Unique_ID)
q4 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=90,hjust = 1))

# Let us do some plotting as per Measurement time

q5 <- ggplot(data=filt4,aes(Measurement_Timestamp,Conductance,color=Unique_ID)) + geom_point() + facet_grid(.~Unique_ID)
q5 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))



```

Both these batteries show quite a lot of degradation in terms of conductance. Battery "1BB0B287-453B-4123-9DA5-AF6F6596B28F" shows a steady degradation accross years and Battery "5F47EE46-50C4-4A8A-8CAC-C483A7AEA880" shows a rapid degradation and then a upward trend. This could mean that the battery was replaced. Let us look at the second battery a bit closer.

```{r}

filt5 <- filt4 %>% filter(Unique_ID == "5F47EE46-50C4-4A8A-8CAC-C483A7AEA880")

# Let us do some plotting as per Measurement time

q6 <- ggplot(data=filt5,aes(Measurement_Timestamp,Conductance)) + geom_point()
q6 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

```

From the above graph, the degradation of this battery also starts from 2012 December and it extends to 2013 Feb and then extends to 2014 August

Let us now look at the second battery from the two we selected with high SD

```{r}
filt6 <- filt4 %>% filter(Unique_ID == "1BB0B287-453B-4123-9DA5-AF6F6596B28F")

# Let us do some plotting as per Date ( Linear line appears)

q7 <- ggplot(data=filt6,aes(Date,Conductance)) + geom_point()
q7 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

# Let us do some plotting as per Measurement time stamp

q8 <- ggplot(data=filt6,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q8 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

```

For this battery the gradual degradation in conductance happens from Jan 2012. However the degradation slope gets steeper from 2012 September to around 2013 February.

Again there is a common thread here of dates between 2012 Sept to 2013 Feb

# Battery with values > 500 but less than 600

Let us first take the case where the SD is more than 700 and see how it fares

```{r}

Cond_SD %>% filter(SD > 500 & SD < 600) %>% select(Unique_ID)

# 054A7AD2-3658-42DD-98D0-454AC2EA3148
# 11E51D42-5518-4649-A989-3BABDA09FD85
# 2F83C61C-2D65-45B2-ABF4-B48409BB5EA5
# 42E2FA79-F71B-4A36-A15F-CBB1700E9A6A
# F226E690-A1D7-4E8A-B02A-E468EC078BC5

```

Let us take the case of these batteries and observe the behaviour accross timeline

```{r}

filt7 <- filt1 %>% filter(Unique_ID %in% c("054A7AD2-3658-42DD-98D0-454AC2EA3148","11E51D42-5518-4649-A989-3BABDA09FD85","2F83C61C-2D65-45B2-ABF4-B48409BB5EA5","42E2FA79-F71B-4A36-A15F-CBB1700E9A6A","F226E690-A1D7-4E8A-B02A-E468EC078BC5"))

# Lets create a date variable

filt7$Date <- as.Date(as.character(filt7$Measurement_Timestamp))


# Let us do some plotting as per date

q9 <- ggplot(data=filt7,aes(Date,Conductance,color=Unique_ID)) + geom_point() + facet_grid(.~Unique_ID)
q9 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=90,hjust = 1))

# Let us do some plotting as per Measurement time

q10 <- ggplot(data=filt7,aes(Measurement_Timestamp,Conductance,color=Unique_ID)) + geom_point() + facet_grid(.~Unique_ID)
q10 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))




```

So from the plots of these 5 batteries it can be seen that, there is some pattern evolving.

Battery 1,2,3 and 5 show a degradation graph. Battery 4 is only a case of an outlier measurement and therefore it can be ignored. 

The 4 batteries where there is a pattern evolving have a very similar pattern of degradation. 

Also another important aspect to note is that for batteries 1,2 and 5 there are no measurements after the drop. So does that indicate failure of the battery ?

Battery 3, the readings regain its original level and then continue till 2016



Need to take these and explore further to find out if they are similar trends in terms of time periods when these are happening.
So let us look closely at battery 1 first

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "054A7AD2-3658-42DD-98D0-454AC2EA3148")

filt4$Date <- as.Date(as.character(filt4$Measurement_Timestamp))

# Let us plot and see the graphs

q11 <- ggplot(data=filt4,aes(Measurement_Timestamp,Conductance)) + geom_point()
q11 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))



```

Let us look more closely at dates after 2013 May

```{r}

filt4_II <- filt4 %>% filter(Date > "2013-05-01" )

# Plotting the same

q12 <- ggplot(data=filt4_II,aes(Measurement_Timestamp,Conductance)) + geom_point()
q12 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

# Taking a closer look at the degradation start point

filt4_II <- filt4_II %>% filter(Date > "2014-11-01" & Date < "2015-03-01" )

q13 <- ggplot(data=filt4_II,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q13 + geom_line() + theme(axis.text.x = element_text(angle=70,hjust = 1))


```

So from the graphs it can be see that the start of degradation is from End of November and the it continues to around February the following year.

# Battery 2

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "11E51D42-5518-4649-A989-3BABDA09FD85")

filt4$Date <- as.Date(as.character(filt4$Measurement_Timestamp))

# Taking a closer look at the dates


filt4_II <- filt4 %>% filter(Date > "2014-10-01" )

# Plotting the same

q14 <- ggplot(data=filt4_II,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q14 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

# Plotting the trends

q15 <- ggplot(data=filt4_II,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q15 + geom_line() + theme(axis.text.x = element_text(angle=70,hjust = 1))

```

This battery also has very similar trend as the earlier battery with the degradation happening from December and then failure point occuring in Feb and continuing till March

# Battery 3

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "2F83C61C-2D65-45B2-ABF4-B48409BB5EA5")

filt4$Date <- as.Date(as.character(filt4$Measurement_Timestamp))

# Taking a closer look at the dates


filt4_II <- filt4 %>% filter(Date > "2013-11-15" & Date < "2014-09-15" )

# Plotting the same

q16 <- ggplot(data=filt4_II,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q16 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

# Plotting the trends

q17 <- ggplot(data=filt4_II,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q17 + geom_line() + theme(axis.text.x = element_text(angle=70,hjust = 1))


```

Again this battery degradation happened in Jan 2014 and then the big drop happened by April 2014 and this down ward trend continues till July 2014

# Battery # 5

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "F226E690-A1D7-4E8A-B02A-E468EC078BC5")

filt4$Date <- as.Date(as.character(filt4$Measurement_Timestamp))

# Taking a closer look at the dates


filt4_II <- filt4 %>% filter(Date > "2014-10-01"  )

# Plotting the same

q18 <- ggplot(data=filt4_II,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q18 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

# Plotting the trends

q19 <- ggplot(data=filt4_II,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q19 + geom_line() + theme(axis.text.x = element_text(angle=70,hjust = 1))


```

Even in this battery the trend is similar to all other batteries. The flux starts by October and then degradation happens by Jan and then culminates in the big drop by Feb and then it continues.

# Batteries between 400 and 500

```{r}
Cond_SD %>% filter(SD > 400 & SD < 500) %>% select(Unique_ID)

# # 0124308E-E6E8-4AE7-ABBE-E56561FE8CC0
# 2  11E1F01B-39CA-41FC-AF37-863543C1A427
# 3  14525931-DD65-4E15-A1C6-C1AF1588B9FC
# 4  21CACF45-93A9-40BC-9298-3987DD1881F8
# 5  2567A348-2E85-4C54-B24E-C69D3F85ACF3
# 6  2E108B85-4D21-4A29-8947-0A9CE5033354
# 7  3BA11CF9-EACA-4AA8-A77F-4DF23B29AAAB
# 8  58CC8861-5D3C-4987-9DFF-F27042E5C1DF
# 9  59B5DC3C-D5C3-4E1C-BC48-B7901E4D58FF
# 10 62CF70F0-2B7A-4AB1-9197-B3E1F760C4C2
# 11 863790DC-B158-4AA5-8C5C-B7644D6911A2
# 12 889DC298-B847-4926-BBA6-4641C0E27D1A
# 13 AD3A7E81-5915-453C-BF32-61D8890A0C31
# 14 B1FE80C1-C000-4775-9EAE-DA4FB922524C
# 15 BFFE4264-0469-4EDB-A52C-DFFD8B5F3159
# 16 CF6432BD-8444-4D5E-838A-3B7315624036
# 17 CFB86713-5A6C-45A4-A100-94F26C060203
# 18 F5E62AD0-F697-471C-A433-3E9BD167FDC5
# 19 F8CBFC2A-5592-4B02-AF78-BFB926E940B6
# 20 FFFA4203-0579-42C9-A05A-38565BA92628

```



```{r}

filt3 <- filt1 %>% filter(Unique_ID %in% c("0124308E-E6E8-4AE7-ABBE-E56561FE8CC0","11E1F01B-39CA-41FC-AF37-863543C1A427","14525931-DD65-4E15-A1C6-C1AF1588B9FC","21CACF45-93A9-40BC-9298-3987DD1881F8","2567A348-2E85-4C54-B24E-C69D3F85ACF3","2E108B85-4D21-4A29-8947-0A9CE5033354","3BA11CF9-EACA-4AA8-A77F-4DF23B29AAAB","58CC8861-5D3C-4987-9DFF-F27042E5C1DF","59B5DC3C-D5C3-4E1C-BC48-B7901E4D58FF","62CF70F0-2B7A-4AB1-9197-B3E1F760C4C2","863790DC-B158-4AA5-8C5C-B7644D6911A2","889DC298-B847-4926-BBA6-4641C0E27D1A","AD3A7E81-5915-453C-BF32-61D8890A0C31","B1FE80C1-C000-4775-9EAE-DA4FB922524C","BFFE4264-0469-4EDB-A52C-DFFD8B5F3159","CF6432BD-8444-4D5E-838A-3B7315624036","CFB86713-5A6C-45A4-A100-94F26C060203","F5E62AD0-F697-471C-A433-3E9BD167FDC5","F8CBFC2A-5592-4B02-AF78-BFB926E940B6","FFFA4203-0579-42C9-A05A-38565BA92628"))

# Lets create a date variable

filt3$Date <- as.Date(as.character(filt3$Measurement_Timestamp))

# Let us do some plotting as per date

q20 <- ggplot(data=filt3,aes(Date,Conductance,color=Unique_ID)) + geom_point() + facet_grid(.~Unique_ID)
q20 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=90,hjust = 1))



```

From the above graphs almost 14 of the 20 is showing trends similar to the ones observed before. Let us look at how each one fare with respect to the trends we saw earlier

# Summary level trends observed from a sample of these 20 batteries

# Battery 3 - Degradation initiation : 2014 - Dec : Sharp failure - 2015 - Mid Jan and Feb : Most of fluxes : During preceeding winters

# Battery 4 - Degradation initiation : 2014 - Dec : Sharp failure - 2015 - Mid Jan and Feb : Most of fluxes : During preceeding winters

# Battery 6 - Degradation initiation : 2014 - Nov : Sharp failure - 2015 - Mid Jan and Feb : Most of fluxes : During preceeding winters : Plant - A, String : 2, Battery - 1

# Battery 7 - Degradation initiation : 2013 - June : Sharp failure - No: Mild failure- 2014 - Mid Oct: Most of fluxes : During preceeding winters : Plant - 1043, String : A, Battery - 2

# Battery 8 - Degradation initiation : 2014 - Feb : Sharp failure - 2014 - Sept: : Most of fluxes : NA : Plant - A1 - A4 POS, String : A3 POS, Battery - 14

# Battery 9 - Degradation initiation : 2014 - Dec : Sharp failure - 2015 Mid Jan - Feb : : Most of fluxes : During preceeding winters : Plant - A, String : 2, Battery - 13

So the trend is very similar and commonalities in terms of Months and most of the parameters.

## 

# Battery 20 - Degradation initiation : 2014 - Nov : Sharp failure - 2015 - Mid Jan and Feb : Most of fluxes : During preceeding winters : Plant - A, String : 2, Battery - 10

# Battery 17 - Degradation initiation : 2014 - Nov : Sharp failure - 2015 - Mid Jan and Feb : Most of fluxes : During preceeding winters : Plant - A, String : 2, Battery - 3


# Batteries between 200 and 400 - Case of Impending failures

```{r}

temp <- Cond_SD %>% filter(SD > 200 & SD < 400) %>% select(Unique_ID)

# Take a sample of 10 each

samp1 <- sample(temp$Unique_ID,10,replace=FALSE)

# Printing 10 at a time

for(i in 1:10) {

te <- paste(samp1[i])

print(te)
  
}

# "9B32480B-C1AD-4AEE-9B0E-4711AA504D2C"
# "6D6A27CD-354F-492E-B1B4-70AE5E91646D"
# [1] "D97C8C06-F617-4DD2-AA8E-B4F2D93921F9"
# [1] "8AC54B72-75C5-4D8D-B59B-31DBF36D9BC9"
# [1] "7A63305E-3EA5-4F10-A84F-8F788F91C4EE"
# [1] "FF232DF9-CB5F-466D-B1B7-7C1CE324D204"
# [1] "53ABC311-DD77-4769-A279-803FE61CC0EB"
# [1] "A8FC24B2-B405-443C-A057-73F443F17EC2"
# [1] "00AB6F4B-6517-4546-B852-A2CDF4DCAAF0"
# [1] "9F75D7E7-A32A-4C32-AFCD-4E00482E3D1D"

```


```{r}

filt3 <- filt1 %>% filter(Unique_ID %in% c("AB96615A-2073-4807-9641-8E3979B59AF6","968DC5CD-A30C-40A4-9A87-C31B4C6CA2AB","1B399EC5-A1E6-4958-89FD-A27B374E58B0","F08538A6-C820-42E8-99BA-B61E9F6DFC3A","78D9B67A-3DB2-4018-BC21-01DDFE6DFC31","9B32480B-C1AD-4AEE-9B0E-4711AA504D2C","E81D0E6C-4C5C-4069-B947-BF50831BCFED","8AC54B72-75C5-4D8D-B59B-31DBF36D9BC9","ED527921-15FD-456A-BA48-FD72944C22C7","50972473-90CA-4181-90A8-A6D794658B40"))

# Lets create a date variable

filt3$Date <- as.Date(as.character(filt3$Measurement_Timestamp))

# Let us do some plotting as per date

q21 <- ggplot(data=filt3,aes(Date,Conductance,color=Unique_ID)) + geom_point() + facet_grid(.~Unique_ID)
q21 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=90,hjust = 1))

# Let us do some plotting as per Measurement time

q22 <- ggplot(data=filt3,aes(Measurement_Timestamp,Conductance,color=Unique_ID)) + geom_point() + facet_grid(.~Unique_ID)
q22 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

```

So as seen we see a failing trend in cases where the SD is over 400 and from 200 to 400 we see a falling trend which would indicate an impending failure.

Next task is to connect these failing trends with other variables in the conductance

# Feature Engineering and Modelling intuitions which were derived out of these findings

1. Use the Standard deviations of the conductance data as a variable to seperate the cases.
2. Make new variables associated with the slope of conductance trends to inidicate time periods before failure i.e associate failure with rate of change of slope of the readings
3. Bring in new classifications of failure from the existing data like 1 week before failure, 1 month before failure etc and train the models accordingly
4. Understand what is so special about the months of October, Nov, Dec etc where we see a rising trend in failures ? Do we need to include load factor of the sites ??
5. Do we look at the age of the battery as a variable, i.e when the new battery was commissioned and when they are failing ?
6. Look at outliers and see if there are any trends in the outliers ( eg. erraneous methods of data capture ?)
7. Associating other variables like voltage, temperature , Current etc to the batteries which were failing 

```{r}

Cond_SD %>% filter(SD > 0 & SD < 50) %>% select(Unique_ID)

filt41 <- filt1 %>% filter(Unique_ID == "00098F17-E771-482B-8BAB-20482B5A86DE")

filt41$Date <- as.Date(as.character(filt41$Measurement_Timestamp))



# Plotting the same

q41 <- ggplot(data=filt41,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q41 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1))

# Plotting the trends

q42 <- ggplot(data=filt41,aes(Measurement_Timestamp,Conductance,group=1)) + geom_point()
q42 + geom_line() + theme(axis.text.x = element_text(angle=70,hjust = 1))


```


# Introducing the Voltage from the Discharge Data

```{r}

library(dplyr)

Battery_200 <- Cond_SD %>% filter(SD > 200) %>% select(Unique_ID,SD)

Battery_200 <- Battery_200 %>% arrange(desc(SD))

# Taking the voltage data of the first 10 Battery which showed the largest variation

tempid <- paste(Battery_200$Unique_ID[1:10])

# Creating a data set with all these readings
filt50 <- data.frame(matrix(nrow=0,ncol=12))
colnames(filt50) <- colnames(Battery_discharge)


# Looping over to create a data set

for(i in 1:length(tempid)){
  
tempfilt <- Battery_discharge %>% filter(Unique_ID == tempid[i])
filt50 <- rbind(filt50,tempfilt)
tempfilt <- Battery_discharge1 %>% filter(Unique_ID == tempid[i])
filt50 <- rbind(filt50,tempfilt)
tempfilt <- Battery_discharge2 %>% filter(Unique_ID == tempid[i])
filt50 <- rbind(filt50,tempfilt)
  
}

filt50$Date <- as.Date(as.character(filt50$Measurement_Timestamp))

# For Conductance

filt60 <- data.frame(matrix(nrow=0,ncol=15))
colnames(filt60) <- colnames(filt1)

for(i in 1:length(tempid)){
  
tempfilt <- filt1 %>% filter(Unique_ID == tempid[i])
filt60 <- rbind(filt60,tempfilt)
tempfilt <- filt1 %>% filter(Unique_ID == tempid[i])
filt60 <- rbind(filt60,tempfilt)
tempfilt <- filt1 %>% filter(Unique_ID == tempid[i])
filt60 <- rbind(filt60,tempfilt)
  
}

filt60$Date <- as.Date(as.character(filt60$Measurement_Timestamp))


```

Plotting both the data sets for Conductance and Voltage

```{r}

library(ggplot2)

# For Voltage

q24 <- ggplot(data=filt50,aes(Measurement_Timestamp,Voltage,color=Unique_ID)) + geom_point()
q24 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1)) + facet_grid(.~Unique_ID)


q25 <- ggplot(data=filt50,aes(Date,Voltage,color = Unique_ID)) + geom_point()
q25 + geom_smooth() + theme(axis.text.x = element_text(angle=70,hjust = 1)) + facet_grid(.~Unique_ID)

# For Conductance

q26 <- ggplot(data=filt60,aes(Date,Conductance,color=Unique_ID)) + geom_point()
q26 + geom_smooth(method="lm") + theme(axis.text.x = element_text(angle=70,hjust = 1)) + facet_grid(.~Unique_ID)


```

Are we seeing a trend where the variance of voltage is high when the conductance is not varying much ?

Is there an inverse relationship between variance of conductance and variance of voltage ?

# Next tasks

1. Bring in the relationship between Temperature & Current and the failing batteries 
2. Build new variables based on these inferences
3. Attempt some sample models and check for results

From the analysis of the cases with all the other variables there were some 5 types of trends which emerged. 

# Type I Trend : Cup like Trends - Conductance regains the original level after a large drop

- A cup shaped cyclical trend. Current rises and then falls. The number of cup shaped observations are 3. The conductance retracts to its original level which might indicate replacement of the battery. So does the replacement trend indicate a failed battery ? Does these cyclical cup shaped discharge profile indicate failure ?


The cup shaped profile is acually series of smaller frequencies where the voltage goes near the threashold voltage level of 80% of voltage.

Batteries showing this profile

Sample Battery 1 : 2F83C61C-2D65-45B2-ABF4-B48409BB5EA5
```{r}

filt4 <- filt1 %>% filter(Unique_ID == "2F83C61C-2D65-45B2-ABF4-B48409BB5EA5")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "2F83C61C-2D65-45B2-ABF4-B48409BB5EA5")
# Not present VT
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "2F83C61C-2D65-45B2-ABF4-B48409BB5EA5")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3)

# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Zooming in

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date == "2013-02-28")

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Further Zooming 2013-02-28 16:31:17

Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2013-02-28 16:31:00 IST" & Date1 < "2013-02-28 16:32:15 IST") # 

q6 <- ggplot(data=Temp_bat_spot1,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q6 + theme(axis.text.x=element_text(angle=70,hjust=1))



```

0124308E-E6E8-4AE7-ABBE-E56561FE8CC0 - Constant Conductance _ SD between 400 & 500

This battery shows a cup shaped formulation for its Voltage discharge. the number of cups are less. The Voltage sustenance at the discharge level is for higher duration. There are also some instances of smaller frequencies. It is found that when the current is being varied, i.e when the current increases the voltage cup like shape is formed . However when the current is kep constant, the cycles involved are lesser.

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "0124308E-E6E8-4AE7-ABBE-E56561FE8CC0")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "0124308E-E6E8-4AE7-ABBE-E56561FE8CC0")

# Not present VT
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "0124308E-E6E8-4AE7-ABBE-E56561FE8CC0")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3)

# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in - Funnel shaped trends of current and voltage

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date == "2014-01-16") # & Date < "2014-07-06"

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Further Zooming 2014-01-16 14:30:27 - A series of frequencies trending downwards

Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2014-01-16 14:30:27 IST" & Date1 < "2014-01-16 14:31:27 IST") # 

q6 <- ggplot(data=Temp_bat_spot1,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q6 + theme(axis.text.x=element_text(angle=70,hjust=1))

```

11E1F01B-39CA-41FC-AF37-863543C1A427 - Constant Conductance - Same trend as previous

Voltage temperature readings were not present. The below zooms in on the increasing trend in current and the decreasing trend in voltage. When the current is kept constant there is a small cycle which is getting executed. 

 Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2014-01-16 14:30:16 IST" & Date1 < "2014-01-16 14:32:15 IST") #
 
 Also it needs to be noted that for replicating this problem, the temperature and voltage values are not present in the current data frame and therefore it needs to be introduced.
 
 Also from a domain perspective, if the key variables are depth of discharge and also frequency of the cycles, this trend will meet the criteria. These trends shows number of cycles and achievement of the depth of discharge variables.
 
 
```{r}
filt4 <- filt1 %>% filter(Unique_ID == "11E1F01B-39CA-41FC-AF37-863543C1A427")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "11E1F01B-39CA-41FC-AF37-863543C1A427")
# Not present VT
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "0124308E-E6E8-4AE7-ABBE-E56561FE8CC0")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3)

# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in - Funnel shaped trends of current and voltage

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date == "2014-01-16") # & Date < "2014-07-06"

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Further Zooming 2014-01-16 14:30:27 - A series of frequencies trending downwards

Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2014-01-16 14:30:16 IST" & Date1 < "2014-01-16 14:32:15 IST") # 

q6 <- ggplot(data=Temp_bat_spot1,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q6 + theme(axis.text.x=element_text(angle=70,hjust=1))

```

Battery 3 : 2567A348-2E85-4C54-B24E-C69D3F85ACF3 - Constant Conductance

Constant conductance battery. This type again, similar to the once see above. The discharge voltage shows some cup like discharge profile. There are also some sharp discharge profiles for relatively constant current. However even the large cup like voltage profile are smaller wave like discharge cycles. 

Charachteristics I
Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2014-01-16 14:30:16 IST" & Date1 < "2014-01-16 14:32:15 IST")

Characteristics II
Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2014-03-25" & Date < "2014-03-27" )

The second characteristics is for the shorter discharge profile in the whole section. The discharge voltage dips and shows a gradual rise. This profile is different from the long cup shaped profile with many smaller frequency profiles when the current keeps rising.

```{r}
filt4 <- filt1 %>% filter(Unique_ID == "2567A348-2E85-4C54-B24E-C69D3F85ACF3")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "2567A348-2E85-4C54-B24E-C69D3F85ACF3")
# Not present VT
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "2567A348-2E85-4C54-B24E-C69D3F85ACF3")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3)

# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in - Funnel shaped trends of current and voltage

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date == "2014-01-16") # & Date < "2014-07-06"

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Further Zooming 2014-01-16 14:30:27 - A series of frequencies trending downwards

Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2014-01-16 14:30:16 IST" & Date1 < "2014-01-16 14:32:15 IST") # 

q6 <- ggplot(data=Temp_bat_spot1,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q6 + theme(axis.text.x=element_text(angle=70,hjust=1))

```

Battery 5 - CF6432BD-8444-4D5E-838A-3B7315624036 - Constant Conductance : No VT
 
Constant conductance battery. This type again, similar to the once see above. The discharge voltage shows some cup like discharge profile. There are also some sharp discharge profiles for relatively constant current. However even the large cup like voltage profile are smaller wave like discharge cycles.


Battery 6 - 889DC298-B847-4926-BBA6-4641C0E27D1A -  Constant Conductance : HOckey stick & W trends

These batteries are the ones with constant conductance. However it shows an initial hockey stick like profile in the beginning and sharp "w" profiles later on. 

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-03-22" & Date < "2013-03-24" ) 

Voltage is mostly constant, with small varying current. Only when the current shows large drop we have a sinusoidal wave like profile of the voltage

Profile 1 - A dropping and constant profile.

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2014-04-06" & Date < "2014-04-08" )

With rising current the voltage drops and then it rises one the current is kep constant. The voltage also remains constant with the current kept constant.


Battery 7 : 3BA11CF9-EACA-4AA8-A77F-4DF23B29AAAB : Replacement Batteries: HOckey stick like trends
- These are the batteries which must have been replaced. The discharge profile shows some hockey stick like profile shape.


Charachteristics I - "Ice Hockey stick Profile"

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-09-13" & Date < "2013-09-15" ) # Bigger picture

Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2013-09-14 22:50:00 IST" & Date1 < "2013-09-14 22:53:15 IST") #
Spotlight

The hockey stick profile is the predominant charachteristics of this battery. This is a profile where the voltage shows a sudden drop and flattening for a considerable period of time, under a constant current.

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "3BA11CF9-EACA-4AA8-A77F-4DF23B29AAAB")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "3BA11CF9-EACA-4AA8-A77F-4DF23B29AAAB")
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "3BA11CF9-EACA-4AA8-A77F-4DF23B29AAAB")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

Temp_bat4 <- Temp_bat_sec %>% select(Measurement_Timestamp,Temperature)
Temp_bat4$measure <- "Temperature"

Temp_bat5 <- Temp_bat_sec %>% select(Measurement_Timestamp,Voltage)
Temp_bat5$measure <- "Volttemp"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- colnames(Temp_bat4) <- colnames(Temp_bat5) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3,Temp_bat4,Temp_bat5)


# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in - Hockey stick profile

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-09-13" & Date < "2013-09-15" ) # Bigger picture

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Further Zooming 2014-01-16 14:30:27 - A series of frequencies trending downwards

Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2013-09-14 22:50:00 IST" & Date1 < "2013-09-14 22:53:15 IST") # 

q6 <- ggplot(data=Temp_bat_spot1,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q6 + theme(axis.text.x=element_text(angle=70,hjust=1))


```

Battery 8 : 42E2FA79-F71B-4A36-A15F-CBB1700E9A6A - Constant Conductance

```{r}
filt4 <- filt1 %>% filter(Unique_ID == "42E2FA79-F71B-4A36-A15F-CBB1700E9A6A")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "42E2FA79-F71B-4A36-A15F-CBB1700E9A6A")
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "42E2FA79-F71B-4A36-A15F-CBB1700E9A6A")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

Temp_bat4 <- Temp_bat_sec %>% select(Measurement_Timestamp,Temperature)
Temp_bat4$measure <- "Temperature"

Temp_bat5 <- Temp_bat_sec %>% select(Measurement_Timestamp,Voltage)
Temp_bat5$measure <- "Volttemp"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- colnames(Temp_bat4) <- colnames(Temp_bat5) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3,Temp_bat4,Temp_bat5)


# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in - Hockey stick profile

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-03-22" & Date < "2013-03-24" ) # Bigger picture

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))



```


# Type II Trend - Falling discharge voltage


Lot of cyclic frequencies followed by a big drop in voltage. However, it is not beyond the 80% limit

This battery shows a trend, where there are many cycles of discharge with some sharp discharge profiles. The voltage then falls in conjunction with the falling conductance. However the depth of discharge is never met. The discharge profile is represented as a "w" kind of profile and this is achieved over a period of day. 

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2012-09-23" & Date < "2012-09-25" )

The above code is a representation of the close up of a "w" trend in voltage discharge. The current is kept constant. There are two cycles over time frame of a day. 

Battery 1 : 21CACF45-93A9-40BC-9298-3987DD1881F8 - 

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "21CACF45-93A9-40BC-9298-3987DD1881F8")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "21CACF45-93A9-40BC-9298-3987DD1881F8")
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "21CACF45-93A9-40BC-9298-3987DD1881F8")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

Temp_bat4 <- Temp_bat_sec %>% select(Measurement_Timestamp,Temperature)
Temp_bat4$measure <- "Temperature"

Temp_bat5 <- Temp_bat_sec %>% select(Measurement_Timestamp,Voltage)
Temp_bat5$measure <- "Volttemp"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- colnames(Temp_bat4) <- colnames(Temp_bat5) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3,Temp_bat4,Temp_bat5)

# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in Charachteristics I : W profile

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2012-09-23" & Date < "2012-09-25" )

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# # Further Zooming 2014-01-16 14:30:27 - A series of frequencies trending downwards
# 
# Temp_bat_spot1 <- Temp_bat_consol %>% filter(Date1 > "2014-01-16 14:30:16 IST" & Date1 < "2014-01-16 14:32:15 IST") # 
# 
# q6 <- ggplot(data=Temp_bat_spot1,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
# q6 + theme(axis.text.x=element_text(angle=70,hjust=1))


```

 Battery 2 : 58CC8861-5D3C-4987-9DFF-F27042E5C1DF 
 
The general trend is drop in conductance  and then a drop in voltage lower than the 80% level. It goes even to zero. So the depth of discharge is attained. So has this battery failed ??

Charachteristics I : Hockey stick profile

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-03-03" & Date < "2013-03-05" ) #

The above shows a hockey stick profile. However, when the current drops the voltage also rises as expected. Otherwise the voltage profile shows a constant profile for the voltage.

Characteristics II : "Ro" profile
Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-06-24" & Date < "2013-06-26" ) # 
Shows the sudden dip and then rising and then constant profile. When the current is dropped then the voltage picks up and when the current is kept constant, the voltage also remains constant.

Charachteristics III : A gradual drop, 0 voltage and bouncing

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2014-03-25"  ) 
The surprising fact about this profile is that the discharge voltage attains a 0 voltage and then it rises back when the current is raised. Ideally when the current drawn is raised the voltage has to be reduced.

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "58CC8861-5D3C-4987-9DFF-F27042E5C1DF")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "58CC8861-5D3C-4987-9DFF-F27042E5C1DF")

# No VT
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "58CC8861-5D3C-4987-9DFF-F27042E5C1DF")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3)

# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in Charachteristics I : Hockey stick profile

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-03-03" & Date < "2013-03-05" ) #


q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Characteristics II : "Ro" profile
Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-06-24" & Date < "2013-06-26" ) # 

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Charachteristics III : A gradual drop, 0 voltage and bouncing

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2014-03-25"  ) 

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

```

Battery 3 : 14525931-DD65-4E15-A1C6-C1AF1588B9FC

This battery shows the trend of falling discharge voltage with many "w" shaped discharges and then finally a large drop in voltage which corresponds to the drop in conductance. The number of discharge cycles are larger. 

Same date profile of 24th Sept as the below battery and similar charachteristics with constant current of 22

```{r}
filt4 <- filt1 %>% filter(Unique_ID == "14525931-DD65-4E15-A1C6-C1AF1588B9FC")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "14525931-DD65-4E15-A1C6-C1AF1588B9FC")
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "14525931-DD65-4E15-A1C6-C1AF1588B9FC")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

Temp_bat4 <- Temp_bat_sec %>% select(Measurement_Timestamp,Temperature)
Temp_bat4$measure <- "Temperature"

Temp_bat5 <- Temp_bat_sec %>% select(Measurement_Timestamp,Voltage)
Temp_bat5$measure <- "Volttemp"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- colnames(Temp_bat4) <- colnames(Temp_bat5) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3,Temp_bat4,Temp_bat5)

# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in Charachteristics I : W profile

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2012-09-23" & Date < "2012-09-25" )

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))



```

# CFB86713-5A6C-45A4-A100-94F26C060203 - Type II - Falling discharge voltage
Sharp "W" profile
# F5E62AD0-F697-471C-A433-3E9BD167FDC5 -Type II - Falling discharge voltage
Sharp "W" profile
# 863790DC-B158-4AA5-8C5C-B7644D6911A2 - Type II - Falling discharge voltage
Very sharp features of "w" profile


# Trend  III - Rising discharge voltage

This is of type III where the characteristic is or of many cyclic frequencies followed by a large rise in voltage. The rise in voltage dosent correspond to drop in current. The drop in voltage is also associated with the drop in conductance. However another charachteristic of this trend is the depth of discharge level is never breached.

Charachteristics I - "W" Profile
Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-03-06" & Date < "2013-03-08" ) # 

This shows a "W" discharge trend with two values of current. However the depth of discharge is not much. The difference in depth with higher current is very small. Once the current is run for some time, first there is this cyclic characteristics and then the voltage stabilizes.

Charachteristics II - "V" Profile
Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-08-08" & Date < "2013-08-10" ) # 

This profile is when the current is kep constant. The discharge profile shows a dip and then a rise to the original level. After some time the voltage again rises. Need to know why with constant current the voltage keeps on rising ?

Charachteristics III - "Rising V" Profile
Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2014-01-09" & Date < "2014-01-12" ) # 

This charachteristic is a rising "V" under constant current. Again it is intriuging why the voltage increase with the same current level.

Charachteristics IV - "Escalator" Profile
Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2015-03-12" & Date < "2015-03-14" ) # 

So this is the last kind of distinct profile which was noted for this type of battery. It corresponded with the a higher current. However, the voltage has shown an increase when the current is kept constant.

Battery I : 2E108B85-4D21-4A29-8947-0A9CE5033354

```{r}

filt4 <- filt1 %>% filter(Unique_ID == "2E108B85-4D21-4A29-8947-0A9CE5033354")
Temp_bat <- Battery_discharge %>% filter(Unique_ID == "2E108B85-4D21-4A29-8947-0A9CE5033354")
Temp_bat_sec <- Battery_voltemp %>% filter(Unique_ID == "2E108B85-4D21-4A29-8947-0A9CE5033354")

# Consolidation

Temp_bat1 <- Temp_bat %>% select(Measurement_Timestamp,Voltage)
Temp_bat1$measure <- "Voltage"

Temp_bat2 <- Temp_bat %>% filter(Current < 50) %>% select(Measurement_Timestamp,Current)
Temp_bat2$measure <- "Current"

Temp_bat3 <- filt4 %>% select(Measurement_Timestamp,Conductance)
Temp_bat3$measure <- "Conductance"

Temp_bat4 <- Temp_bat_sec %>% select(Measurement_Timestamp,Temperature)
Temp_bat4$measure <- "Temperature"

Temp_bat5 <- Temp_bat_sec %>% select(Measurement_Timestamp,Voltage)
Temp_bat5$measure <- "Volttemp"

colnames(Temp_bat1) <- colnames(Temp_bat2) <- colnames(Temp_bat3) <- colnames(Temp_bat4) <- colnames(Temp_bat5) <- c("Measurement_Timestamp","Variable","measure")

Temp_bat_consol <- rbind(Temp_bat1,Temp_bat2,Temp_bat3,Temp_bat4,Temp_bat5)

# Date variable

Temp_bat_consol$Date <- as.Date(as.character(Temp_bat_consol$Measurement_Timestamp))

Temp_bat_consol$Date1 <- as.POSIXct(as.character(Temp_bat_consol$Measurement_Timestamp))

# Plotting 

q5 <- ggplot(data=Temp_bat_consol,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q5 + theme(axis.text.x=element_text(angle=70,hjust=1))

# To find some individual trends

unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date))

nrow(unique(Temp_bat_consol %>% filter(measure=="Voltage") %>% select(Date)))

# Zooming in Charachteristics I : W profile


Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-03-06" & Date < "2013-03-08" ) 

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))


# Zooming in Charachteristics II - "V" Profile
Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2013-08-08" & Date < "2013-08-10" ) # 

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Zooming in "Rising V" Profile

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2014-01-09" & Date < "2014-01-12" ) #

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

# Zooming in Charachteristics IV - "Escalator" Profile

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2015-03-12" & Date < "2015-03-14" )

q7 <- ggplot(data=Temp_bat_spot2,aes(as.factor(Date1),Variable,color=measure)) + geom_point() + facet_grid(measure~.,scales = "free") # ,margins =TRUE can be included if we want everything together in one graph
q7 + theme(axis.text.x=element_text(angle=70,hjust=1))

```

Battery 2 : 59B5DC3C-D5C3-4E1C-BC48-B7901E4D58FF 
A consolidated plot was made between, conductance, voltage and current. So drop in conductance was followed by a rise in both current and voltage. Also the cycles of discharge was large with each cycle having a lower width. The dept of discharge wasnt that significant. From the data it dosent show any evidence that the prescribed depth has been breached.

The detailed plot of the discharge voltage shows "w" profile. However the depth attained was within the limits when the current was kept constant.

Temp_bat_spot2 <- Temp_bat_consol %>% filter(Date > "2014-01-09" & Date < "2014-01-11" )

Battery 3 : 62CF70F0-2B7A-4AB1-9197-B3E1F760C4C2 

Battery 4 :AD3A7E81-5915-453C-BF32-61D8890A0C31 - Type III - Rising discharge voltage

Battery 5 : B1FE80C1-C000-4775-9EAE-DA4FB922524C - Type III - Rising discharge voltage
Battery 6 : BFFE4264-0469-4EDB-A52C-DFFD8B5F3159 - Type III - Rising discharge voltage
Battery 7 : F8CBFC2A-5592-4B02-AF78-BFB926E940B6 - Type III - Rising discharge voltage
Battery 8 : FFFA4203-0579-42C9-A05A-38565BA92628 - Type III - Rising discharge voltage




